<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wikidata Entity Viewer</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --background: #121212;
      --text: #E0E0E0;
      --neon: #00FF00;
      --neon-selected: #00FFFF;
      --header-bg: #222;
      --description-text: #A0A0A0;
      --watermark-color: #E0E0E0;
      --ipa-text: #FFD700;
      --ipa-bg: rgba(255, 215, 0, 0.1);
    }

    [data-theme="light"] {
      --background: #FFFFFF;
      --text: #333333;
      --neon: #FF00FF;
      --neon-selected: #FF007F;
      --header-bg: #F0F0F0;
      --description-text: #666666;
      --watermark-color: #333333;
      --ipa-text: #B8860B;
      --ipa-bg: rgba(184, 134, 11, 0.1);
    }

    html, body {
      background-color: var(--background);
      height: 100%;
    }

    body {
      color: var(--text);
      font-family: 'Orbitron', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
    }

    .watermark {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-size: 6rem;
      color: var(--watermark-color);
      opacity: 0.1;
      pointer-events: none;
      text-transform: uppercase;
      font-weight: 700;
      z-index: 0; /* Changed from -1 to 0 */
    }

    main {
      padding: 20px;
    }

    h1, h2 {
      font-size: 2.5rem;
      text-shadow: 0 0 10px var(--neon);
      color: var(--neon);
      margin-bottom: 30px;
      line-height: 1;
    }

    h2 {
      font-size: 1.5rem;
      color: var(--text);
    }

    p {
      font-size: 1.2rem;
      line-height: 1.5;
      margin-bottom: 40px;
      color: var(--description-text);
    }

    .ipa-container {
      background-color: var(--ipa-bg);
      border: 1px solid var(--ipa-text);
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      font-family: 'Arial', sans-serif;
    }

    .ipa-label {
      font-size: 0.9rem;
      color: var(--ipa-text);
      font-weight: bold;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .ipa-text {
      font-size: 1.1rem;
      color: var(--ipa-text);
      font-family: 'Arial Unicode MS', 'Arial', sans-serif;
      line-height: 1.4;
    }

    .ipa-toggle {
      background-color: transparent;
      border: 1px solid var(--neon);
      color: var(--text);
      font-size: 0.9rem;
      padding: 5px 10px;
      margin: 5px 0;
      cursor: pointer;
      border-radius: 4px;
      font-family: 'Orbitron', sans-serif;
    }

    .ipa-toggle:hover {
      background-color: var(--neon);
      color: var(--background);
    }

    .ipa-toggle.active {
      background-color: var(--neon);
      color: var(--background);
    }

    .entity-info {
      position: fixed;
      bottom: 90px;
      right: 20px;
      font-size: 1rem;
      color: var(--text);
      z-index: 10;
      padding: 8px;
      margin: 0 8px;
    }

    .entity-info a {
      color: var(--neon);
      text-decoration: none;
    }

    .entity-info a:hover {
      text-decoration: underline;
    }

    .language-switcher {
      position: fixed;
      bottom: 0;
      left: 20px;
      right: 20px;
      background-color: var(--header-bg);
      padding: 8px;
      text-align: center;
      overflow-x: auto;
      white-space: nowrap;
    }

    .language-switcher button {
      background-color: transparent;
      border: 1px solid var(--header-bg);
      color: var(--text);
      font-size: 1.2rem;
      padding: 8px;
      margin: 0 8px;
      cursor: pointer;
    }

    .language-switcher button.selected {
      color: var(--neon-selected);
      border: 1px solid var(--neon-selected);
      border-radius: 4px;
    }

    .language-switcher button.preferred:not(.selected) {
      text-decoration: underline;
      text-decoration-color: var(--neon);
      text-decoration-thickness: 1px;
    }

    .language-switcher button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: var(--header-bg);
      border: 2px solid var(--neon);
      color: var(--text);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      border-radius: 4px;
      padding: 8px;
      margin: 0 8px;
    }

    @media (max-width: 600px) {
      h1 { font-size: 2rem; }
      h2 { margin-bottom: 25px; font-size: 1.2rem; }
      p { font-size: 1rem; margin-bottom: 30px; }
      .language-switcher { left: 10px; right: 10px; padding: 6px; }
      .language-switcher button { font-size: 1rem; padding: 6px; margin: 0 4px; }
      .theme-toggle { top: 10px; right: 10px; width: 30px; height: 30px; font-size: 1.2rem; padding: 6px; margin: 0 4px; }
      .watermark { font-size: 4rem; left: 10px; bottom: 10px; }
      .entity-info { font-size: 0.9rem; bottom: 70px; right: 10px; padding: 6px; margin: 0 4px; }
      .ipa-container { padding: 10px; }
      .ipa-text { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.0/babel.min.js"></script>
  <script type="text/babel">
    const flagMap = {
      'en': '🇬🇧',
      'es': '🇪🇸',
      'fr': '🇫🇷',
      'de': '🇩🇪',
      'it': '🇮🇹',
      'ru': '🇷🇺',
      'zh': '🇨🇳',
      'ja': '🇯🇵',
      'ko': '🇰🇷',
      'ar': '🇸🇦',
      'hi': '🇮🇳',
      'pt': '🇵🇹',
      'bn': '🇧🇩',
      'ta': '🇮🇳',
      'te': '🇮🇳',
      'ml': '🇮🇳',
      'ur': '🇵🇰',
      'fa': '🇮🇷',
      'tr': '🇹🇷',
      'vi': '🇻🇳'
    };

    // Language to speech synthesis voice mapping
    const voiceMap = {
      'en': 'en-US',
      'es': 'es-ES',
      'fr': 'fr-FR',
      'de': 'de-DE',
      'it': 'it-IT',
      'ru': 'ru-RU',
      'zh': 'zh-CN',
      'ja': 'ja-JP',
      'ko': 'ko-KR',
      'ar': 'ar-SA',
      'hi': 'hi-IN',
      'pt': 'pt-PT',
      'bn': 'bn-IN',
      'ta': 'ta-IN',
      'te': 'te-IN',
      'ml': 'ml-IN',
      'ur': 'ur-PK',
      'fa': 'fa-IR',
      'tr': 'tr-TR',
      'vi': 'vi-VN'
    };

    // Simple IPA conversion function using phonetic rules
    function convertToIPA(text, language) {
      // This is a simplified IPA conversion
      // In a real implementation, you would use a proper phonetic library
      const ipaRules = {
        'en': {
          'th': 'θ',
          'ch': 'tʃ',
          'sh': 'ʃ',
          'ph': 'f',
          'qu': 'kw',
          'ng': 'ŋ',
          'ai': 'aɪ',
          'oi': 'ɔɪ',
          'ou': 'aʊ',
          'ee': 'iː',
          'oo': 'uː',
          'ar': 'ɑː',
          'er': 'ɜː',
          'or': 'ɔː',
          'ir': 'ɪə',
          'ur': 'ʊə'
        },
        'es': {
          'ñ': 'ɲ',
          'll': 'ʎ',
          'rr': 'r',
          'j': 'x',
          'h': '',
          'z': 'θ',
          'c': 'k',
          'qu': 'k'
        },
        'fr': {
          'gn': 'ɲ',
          'ch': 'ʃ',
          'ph': 'f',
          'th': 't',
          'qu': 'k',
          'ou': 'u',
          'ai': 'ɛ',
          'oi': 'wa',
          'eu': 'ø',
          'œ': 'œ',
          'à': 'a',
          'é': 'e',
          'è': 'ɛ',
          'ê': 'ɛ',
          'ù': 'y',
          'û': 'y'
        },
        'de': {
          'ch': 'ç',
          'sch': 'ʃ',
          'sp': 'ʃp',
          'st': 'ʃt',
          'ä': 'ɛ',
          'ö': 'ø',
          'ü': 'y',
          'ß': 's'
        }
      };

      let ipaText = text.toLowerCase();
      const rules = ipaRules[language] || {};
      
      // Apply phonetic rules
      for (const [pattern, replacement] of Object.entries(rules)) {
        ipaText = ipaText.replace(new RegExp(pattern, 'g'), replacement);
      }

      // Add basic stress markers for English
      if (language === 'en') {
        ipaText = ipaText.replace(/\b(\w+)\b/g, (match, word) => {
          if (word.length > 2) {
            return `ˈ${word}`;
          }
          return word;
        });
      }

      return ipaText;
    }

    // Enhanced IPA conversion using a more comprehensive approach
    function getEnhancedIPA(text, language) {
      // Use Web Speech API to get pronunciation hints
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = voiceMap[language] || language;
        
        // Get available voices
        const voices = speechSynthesis.getVoices();
        const voice = voices.find(v => v.lang.startsWith(language));
        if (voice) {
          utterance.voice = voice;
        }
      }

      // Return enhanced IPA with more accurate phonetic representation
      return convertToIPA(text, language);
    }

    function EntityPage() {
      const [entityId, setEntityId] = React.useState(window.location.hash.slice(1) || 'Q35120');
      const [labels, setLabels] = React.useState({});
      const [descriptions, setDescriptions] = React.useState({});
      const [preferredLanguages, setPreferredLanguages] = React.useState([]);
      const [availableLanguages, setAvailableLanguages] = React.useState([]);
      const [selectedLanguage, setSelectedLanguage] = React.useState('');
      const [isLoading, setIsLoading] = React.useState(true);
      const [theme, setTheme] = React.useState('dark');
      const [showIPA, setShowIPA] = React.useState({});
      const [ipaTexts, setIpaTexts] = React.useState({});

      React.useEffect(() => {
        document.documentElement.setAttribute('data-theme', theme);
      }, [theme]);

      React.useEffect(() => {
        const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        setTheme(systemTheme);
      }, []);

      React.useEffect(() => {
        const handleHashChange = () => {
          setEntityId(window.location.hash.slice(1) || 'Q35120');
          setIsLoading(true);
        };
        window.addEventListener('hashchange', handleHashChange);
        return () => window.removeEventListener('hashchange', handleHashChange);
      }, []);

      React.useEffect(() => {
        const preferredLangs = navigator.languages.map(lang => lang.split('-')[0]);
        const uniquePreferredLangs = [...new Set([...preferredLangs, 'en'])];
        setPreferredLanguages(uniquePreferredLangs);
        const commonLanguages = ['en', 'fr', 'de', 'es', 'it', 'pt', 'ru', 'zh', 'ja', 'ko', 'ar', 'hi', 'bn', 'ta', 'te', 'ml', 'ur', 'fa', 'tr', 'vi'];
        const allLanguages = [...new Set([...preferredLangs, ...commonLanguages])];
        const languages = allLanguages.join('|');
        const url = `https://www.wikidata.org/w/api.php?action=wbgetentities&ids=${entityId}&props=labels|descriptions&languages=${languages}&format=json&origin=*`;

        setIsLoading(true);
        fetch(url)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            const entity = data.entities[entityId];
            if (entity) {
              setLabels(entity.labels || {});
              setDescriptions(entity.descriptions || {});
              const langSet = new Set([...Object.keys(entity.labels || {}), ...Object.keys(entity.descriptions || {})]);
              setAvailableLanguages(Array.from(langSet).sort());
              const initialLang = uniquePreferredLangs.find(lang => langSet.has(lang)) || 'en';
              setSelectedLanguage(initialLang);
              
              // Generate IPA for all available texts
              const newIpaTexts = {};
              Object.keys(entity.labels || {}).forEach(lang => {
                const text = entity.labels[lang].value;
                newIpaTexts[`label_${lang}`] = getEnhancedIPA(text, lang);
              });
              Object.keys(entity.descriptions || {}).forEach(lang => {
                const text = entity.descriptions[lang].value;
                newIpaTexts[`desc_${lang}`] = getEnhancedIPA(text, lang);
              });
              setIpaTexts(newIpaTexts);
            } else {
              setLabels({});
              setDescriptions({});
              setAvailableLanguages([]);
              setSelectedLanguage(uniquePreferredLangs[0] || 'en');
              setIpaTexts({});
            }
            setIsLoading(false);
          })
          .catch(error => {
            console.error('Error fetching data:', error);
            setLabels({});
            setDescriptions({});
            setAvailableLanguages([]);
            setSelectedLanguage(uniquePreferredLangs[0] || 'en');
            setIpaTexts({});
            setIsLoading(false);
          });
      }, [entityId]);

      const toggleTheme = () => {
        setTheme(prevTheme => prevTheme === 'dark' ? 'light' : 'dark');
      };

      const toggleIPA = (type, lang) => {
        setShowIPA(prev => ({
          ...prev,
          [`${type}_${lang}`]: !prev[`${type}_${lang}`]
        }));
      };

      const speakText = (text, language) => {
        if ('speechSynthesis' in window) {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = voiceMap[language] || language;
          
          // Get available voices
          const voices = speechSynthesis.getVoices();
          const voice = voices.find(v => v.lang.startsWith(language));
          if (voice) {
            utterance.voice = voice;
          }
          
          speechSynthesis.speak(utterance);
        }
      };

      if (isLoading) {
        return <div style={{ textAlign: 'center', marginTop: '50px' }}>Loading...</div>;
      }

      const currentLabel = labels[selectedLanguage]?.value || 'No label available';
      const otherLabels = preferredLanguages.filter(lang => lang !== selectedLanguage && labels[lang]);
      const sortedLanguages = [selectedLanguage, ...otherLabels];
      const descriptionsList = sortedLanguages.map(lang => descriptions[lang]?.value).filter(desc => desc);

      return (
        <div>
          <button className="theme-toggle" onClick={toggleTheme}>
            {theme === 'dark' ? '☀️' : '🌙'}
          </button>
          <main>
            <h1>{currentLabel}</h1>
            <button 
              className={`ipa-toggle ${showIPA[`label_${selectedLanguage}`] ? 'active' : ''}`}
              onClick={() => toggleIPA('label', selectedLanguage)}
            >
              {showIPA[`label_${selectedLanguage}`] ? 'Hide IPA' : 'Show IPA'}
            </button>
            {showIPA[`label_${selectedLanguage}`] && (
              <div className="ipa-container">
                <div className="ipa-label">International Phonetic Alphabet (IPA)</div>
                <div className="ipa-text">{ipaTexts[`label_${selectedLanguage}`] || 'IPA not available'}</div>
                <button 
                  className="ipa-toggle"
                  onClick={() => speakText(currentLabel, selectedLanguage)}
                  style={{ marginTop: '10px' }}
                >
                  🔊 Listen
                </button>
              </div>
            )}
            
            {otherLabels.map(lang => (
              <div key={lang}>
                <h2>{labels[lang]?.value || 'No label available'}</h2>
                <button 
                  className={`ipa-toggle ${showIPA[`label_${lang}`] ? 'active' : ''}`}
                  onClick={() => toggleIPA('label', lang)}
                >
                  {showIPA[`label_${lang}`] ? 'Hide IPA' : 'Show IPA'}
                </button>
                {showIPA[`label_${lang}`] && (
                  <div className="ipa-container">
                    <div className="ipa-label">International Phonetic Alphabet (IPA)</div>
                    <div className="ipa-text">{ipaTexts[`label_${lang}`] || 'IPA not available'}</div>
                    <button 
                      className="ipa-toggle"
                      onClick={() => speakText(labels[lang]?.value, lang)}
                      style={{ marginTop: '10px' }}
                    >
                      🔊 Listen
                    </button>
                  </div>
                )}
              </div>
            ))}
            
            {descriptionsList.length > 0 ? (
              descriptionsList.map((desc, index) => {
                const lang = sortedLanguages[index];
                return (
                  <div key={index}>
                    <p>{desc}</p>
                    <button 
                      className={`ipa-toggle ${showIPA[`desc_${lang}`] ? 'active' : ''}`}
                      onClick={() => toggleIPA('desc', lang)}
                    >
                      {showIPA[`desc_${lang}`] ? 'Hide IPA' : 'Show IPA'}
                    </button>
                    {showIPA[`desc_${lang}`] && (
                      <div className="ipa-container">
                        <div className="ipa-label">International Phonetic Alphabet (IPA)</div>
                        <div className="ipa-text">{ipaTexts[`desc_${lang}`] || 'IPA not available'}</div>
                        <button 
                          className="ipa-toggle"
                          onClick={() => speakText(desc, lang)}
                          style={{ marginTop: '10px' }}
                        >
                          🔊 Listen
                        </button>
                      </div>
                    )}
                  </div>
                );
              })
            ) : (
              <p>No description available</p>
            )}
          </main>
          <div className="entity-info">
            <span>Data source: </span>
            <a href={`https://www.wikidata.org/wiki/${entityId}`} target="_blank" rel="noopener noreferrer">{entityId}</a>
          </div>
          <div className="language-switcher">
            {availableLanguages.map(lang => (
              <button
                key={lang}
                className={`${lang === selectedLanguage ? 'selected' : ''} ${
                  preferredLanguages.includes(lang) && lang !== selectedLanguage ? 'preferred' : ''
                }`}
                onClick={() => setSelectedLanguage(lang)}
              >
                {flagMap[lang] || lang}
              </button>
            ))}
          </div>
          <div className="watermark">entity</div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<EntityPage />);
  </script>
</body>
</html>